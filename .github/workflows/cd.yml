# Continuous Deployment
name: CD

on:
  pull_request:
    types: [ closed ] 
    branches: [ master, develop ]

jobs:
  # Deploy en AWS
  deploy:
    # Solo ejecutar si se resolvi√≥ el pull request
    if: github.event.pull_request.merged == true

    # Instancia de Linux Ubuntu
    runs-on: ubuntu-latest

    # Pasos
    steps:
      # Clonar repositorio
      - uses: actions/checkout@v2

      # Deploy en AWS DEV
      - name: Deploy en AWS DEV
        if: github.ref == 'develop'
        env:
          AWS_ACCESS_KEY_DEV: ${{ secrets.AWS_ACCESS_KEY_DEV }}
          AWS_SECRET_KEY_DEV: ${{ secrets.AWS_SECRET_KEY_DEV }}
          AWS_S3_BUCKET_DEV: ${{ secrets.AWS_S3_BUCKET_DEV }}
          AWS_CLOUDFRONT_DEV: ${{ secrets.AWS_CLOUDFRONT_DEV }}
        run: |
          cd frontend
          chmod +x deploy_dev.sh
          ./deploy_dev.sh
